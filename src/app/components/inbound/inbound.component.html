<div class="inbound-container">
<!-- Loading Spinner Overlay -->
  <div *ngIf="loading" class="spinner-overlay" role="status" aria-live="polite">
    <div class="spinner-content">
      <div class="spinner-border text-primary" role="presentation">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3 text-muted">Loading warehouse data...</p>
    </div>
  </div>

  <!-- Main Card -->
  <div class="inbound-card">
    <!-- Header -->
    <div class="card-header">
      <div class="header-content">
        <h1 class="page-title">
          <i class="icon-warehouse"></i> Inbound Warehouse
        </h1>
        <p class="header-subtitle">Manage incoming inventory and shipments</p>
      </div>
    </div>

    <!-- Alert Messages -->
    <div class="alerts-container">
      <!-- Success Alert -->
      <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show animate-in" role="alert">
        <div class="alert-content">
          <i class="icon-check-circle"></i>
          <span>{{ successMessage }}</span>
        </div>
        <button type="button" class="btn-close" (click)="closeAlert('success')" aria-label="Close"></button>
      </div>

      <!-- Error Alert -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show animate-in" role="alert">
        <div class="alert-content">
          <i class="icon-alert-circle"></i>
          <span>{{ errorMessage }}</span>
        </div>
        <button type="button" class="btn-close" (click)="closeAlert('error')" aria-label="Close"></button>
      </div>
    </div>

    <!-- Form -->
    <form [formGroup]="inboundForm" (ngSubmit)="onSubmit()" class="inbound-form">
      <!-- Client Name Section -->
      <div class="form-section">
        <h5 class="section-title">Order Details</h5>
        
        <div class="form-group">
          <label class="form-label">
            Client
            <span class="required-badge">*</span>
          </label>

          <select
            class="form-select"
            formControlName="clientId"
            [class.is-invalid]="isFieldInvalid('clientId')"
            [disabled]="loading"
          >
            <option value="">-- Select Client --</option>
            <option *ngFor="let client of clients" [value]="client.id">
              {{ client.name }}
            </option>
          </select>

          <div class="invalid-feedback" *ngIf="isFieldInvalid('clientId')">
            Client is required
          </div>
        </div>
      </div>

      <!-- Lines Section -->
      <div class="form-section lines-section">
        <div class="section-header">
          <h5 class="section-title">Product Lines</h5>
          <span class="lines-count badge bg-primary">{{ lines.length }} line(s)</span>
        </div>

        <div formArrayName="lines" class="lines-array">
          <div *ngFor="let line of lines.controls; let i = index"
               [formGroupName]="i"
               class="line-card animate-fade-in">

            <!-- Line Header -->
            <div class="line-card-header">
              <span class="line-badge">Line {{ i + 1 }}</span>
              <button
                type="button"
                class="btn btn-sm btn-outline-danger"
                (click)="removeLine(i)"
                [disabled]="lines.length === 1 || loading"
                title="Remove this line"
              >
                <i class="icon-trash"></i> Remove
              </button>
            </div>

            <!-- Line Fields Grid -->
            <div class="line-fields">
              <!-- Product Dropdown -->
              <div class="field-group">
                <label for="product-{{ i }}" class="form-label">
                  Product
                  <span class="required-badge">*</span>
                </label>
                <select
                  class="form-select"
                  id="product-{{ i }}"
                  formControlName="productName"
                  [class.is-invalid]="isLineFieldInvalid(i, 'productName')"
                  [disabled]="loading"
                >
                  <option value="">-- Select Product --</option>
                  <option *ngFor="let product of products" [value]="product.name">
                    {{ product.name }}
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="isLineFieldInvalid(i, 'productName')">
                  <small>Product is required</small>
                </div>
              </div>

              <!-- Section Dropdown -->
              <div class="field-group">
                <label for="section-{{ i }}" class="form-label">
                  Section
                  <span class="required-badge">*</span>
                </label>
                <select
                  class="form-select"
                  id="section-{{ i }}"
                  formControlName="sectionName"
                  [class.is-invalid]="isLineFieldInvalid(i, 'sectionName')"
                  [disabled]="loading"
                >
                  <option value="">-- Select Section --</option>
                  <option *ngFor="let section of sections" [value]="section.name">
                    {{ section.name }}
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="isLineFieldInvalid(i, 'sectionName')">
                  <small>Section is required</small>
                </div>
              </div>

              <!-- Cartons Input -->
              <div class="field-group">
                <label for="cartons-{{ i }}" class="form-label">
                  Cartons
                  <span class="required-badge">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="cartons-{{ i }}"
                  formControlName="cartons"
                  [class.is-invalid]="isLineFieldInvalid(i, 'cartons')"
                  placeholder="0"
                  min="0"
                  [disabled]="loading"
                />
                <div class="invalid-feedback" *ngIf="isLineFieldInvalid(i, 'cartons')">
                  <small>{{ getLineFieldError(i, 'cartons') }}</small>
                </div>
              </div>

              <!-- Pallets Input -->
              <div class="field-group">
                <label for="pallets-{{ i }}" class="form-label">
                  Pallets
                  <span class="required-badge">*</span>
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="pallets-{{ i }}"
                  formControlName="pallets"
                  [class.is-invalid]="isLineFieldInvalid(i, 'pallets')"
                  placeholder="0"
                  min="0"
                  [disabled]="loading"
                />
                <div class="invalid-feedback" *ngIf="isLineFieldInvalid(i, 'pallets')">
                  <small>{{ getLineFieldError(i, 'pallets') }}</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add Line Button -->
        <button
          type="button"
          class="btn btn-outline-primary add-line-btn"
          (click)="addLine()"
          [disabled]="loading"
        >
          <i class="icon-plus"></i> Add Line
        </button>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary btn-lg"
          [disabled]="inboundForm.invalid || submitting || loading"
        >
          <span *ngIf="!submitting">
            <i class="icon-send"></i> Submit Inbound
          </span>
          <span *ngIf="submitting">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Submitting...
          </span>
        </button>
        <button
          type="button"
          class="btn btn-secondary btn-lg"
          (click)="inboundForm.reset(); lines.clear(); lines.push(createNewLine())"
          [disabled]="loading || submitting"
        >
          <i class="icon-undo"></i> Reset
        </button>
      </div>
    </form>
  </div>
</div>
